{% extends "base.html" %}
{% block title %}–°—Ç—É–¥–µ–Ω—Ç—ã{% endblock %}

{% block content %}
<div class="students-management-container">
    <div style="display: flex; justify-content: space-between; align-items: center;">
        <h1 class="page-title">–°–ø–∏—Å–æ–∫ —Å—Ç—É–¥–µ–Ω—Ç–æ–≤</h1>
        <button class="btn btn-primary" onclick="toggleAddForm()">‚ûï –î–æ–±–∞–≤–∏—Ç—å —Å—Ç—É–¥–µ–Ω—Ç–∞</button>
    </div>

    <!-- –§–∏–ª—å—Ç—Ä—ã -->
    <div class="filter-section mt-2">
        <button class="btn btn-small" onclick="toggleFilters()">üîç –§–∏–ª—å—Ç—Ä—ã</button>
        <div id="filters" style="display: none; margin-top: 10px;">
            <div class="form-row">
                <div class="form-group">
                    <label for="filter-name">–°–æ—Ä—Ç–∏—Ä–æ–≤–∞—Ç—å –ø–æ –∏–º–µ–Ω–∏:</label>
                    <select id="filter-name" onchange="sortTableByName()" class="form-input">
                        <option value="">‚Äî</option>
                        <option value="asc">–ê ‚Üí –Ø</option>
                        <option value="desc">–Ø ‚Üí –ê</option>
                    </select>
                </div>
                <div class="form-group">
                    <label for="filter-score">–°–æ—Ä—Ç–∏—Ä–æ–≤–∞—Ç—å –ø–æ –±–∞–ª–ª—É:</label>
                    <select id="filter-score" disabled class="form-input">
                        <option>–í —Ä–∞–∑—Ä–∞–±–æ—Ç–∫–µ...</option>
                    </select>
                </div>
                <div class="form-group">
                    <label for="filter-group">–§–∏–ª—å—Ç—Ä –ø–æ –≥—Ä—É–ø–ø–µ:</label>
                    <select id="filter-group" disabled class="form-input">
                        <option>–°–∫–æ—Ä–æ...</option>
                    </select>
                </div>
            </div>
        </div>
    </div>

    <!-- –§–æ—Ä–º–∞ –¥–æ–±–∞–≤–ª–µ–Ω–∏—è -->
    <div id="addForm" class="add-student-section" style="display: none;">
        <h2 class="section-title">–î–æ–±–∞–≤–∏—Ç—å —Å—Ç—É–¥–µ–Ω—Ç–∞</h2>
        <form method="POST" class="student-form" action="{{ url_for('main.add_student') }}">
            <div class="form-row">
                <div class="form-group">
                    <label for="name">–ò–º—è:</label>
                    <input type="text" id="name" name="name" required class="form-input">
                </div>
                <div class="form-group">
                    <label for="email">Email:</label>
                    <input type="email" id="email" name="email" required class="form-input">
                </div>
            </div>

            <div class="form-actions">
                <button type="submit" class="btn btn-primary">–î–æ–±–∞–≤–∏—Ç—å</button>
            </div>
        </form>
    </div>

    <!-- –¢–∞–±–ª–∏—Ü–∞ —Å—Ç—É–¥–µ–Ω—Ç–æ–≤ -->
    <div class="students-table-container mt-3">
        <table class="students-table" id="studentsTable">
            <thead>
                <tr>
                    <th>–ò–º—è</th>
                    <th>Email</th>
                    <th>–ì—Ä—É–ø–ø–∞</th>
                    <th>–°—Ä–µ–¥–Ω–∏–π –±–∞–ª–ª</th>
                    <th>–î–µ–π—Å—Ç–≤–∏—è</th>
                </tr>
            </thead>
            <tbody>
                {% for student in students %}
                <tr>
                    <td>{{ student.name }}</td>
                    <td>{{ student.email }}</td>
                    <td>‚Äî</td>
                    <td>‚Äî</td>
                    <td class="actions-cell">
                        <form method="POST" action="{{ url_for('main.delete_student', student_id=student.id) }}" onsubmit="return confirm('–£–¥–∞–ª–∏—Ç—å —ç—Ç–æ–≥–æ —Å—Ç—É–¥–µ–Ω—Ç–∞?');">
                            <button type="submit" class="btn btn-danger btn-small">–£–¥–∞–ª–∏—Ç—å</button>
                        </form>
                    </td>
                </tr>
                {% endfor %}
            </tbody>
        </table>
    </div>
</div>

<script>
    function toggleFilters() {
        const filters = document.getElementById('filters');
        filters.style.display = filters.style.display === 'none' ? 'block' : 'none';
    }

    function toggleAddForm() {
        const form = document.getElementById('addForm');
        form.style.display = form.style.display === 'none' ? 'block' : 'none';
    }

    function sortTableByName() {
        const table = document.getElementById("studentsTable").getElementsByTagName("tbody")[0];
        const rows = Array.from(table.rows);
        const order = document.getElementById("filter-name").value;

        rows.sort((a, b) => {
            const nameA = a.cells[0].innerText.toLowerCase();
            const nameB = b.cells[0].innerText.toLowerCase();
            return order === 'asc' ? nameA.localeCompare(nameB) : nameB.localeCompare(nameA);
        });

        rows.forEach(row => table.appendChild(row));
    }
</script>
{% endblock %}
