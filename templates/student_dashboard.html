{% extends "base.html" %}

{% block title %}Панель студента{% endblock %}

{% block content %}
<div class="dashboard-container">
    <h1 class="welcome-title">Добро пожаловать, {{ current_user.name }}!</h1>
    
    {% with messages = get_flashed_messages() %}
        {% if messages %}
            <div class="flashes">
                {% for message in messages %}
                    <div class="flash">{{ message }}</div>
                {% endfor %}
            </div>
        {% endif %}
    {% endwith %}

    <div class="assignments-section">
        <h2 class="section-title">Мои задания</h2>
        
        <div class="assignments-grid">
            {% for assignment in assignments %}
            <div class="assignment-card">
                <div class="assignment-header">
                    <h3>{{ assignment.title }}</h3>
                    <span class="due-date">
                        {% if assignment.deadline %}
                        Срок сдачи: {{ assignment.deadline.strftime('%d.%m.%Y') }}
                        {% else %}
                        Без срока
                        {% endif %}
                    </span>
                </div>
                
                <p class="assignment-topic">{{ assignment.topic }}</p>
                <p class="assignment-description">{{ assignment.description }}</p>
                
                <div class="assignment-status">
                    {% set student_score = scores|selectattr('assignment_id', 'equalto', assignment.id)|first %}
                    {% if student_score %}
                        <div class="score submitted">
                            Ваша оценка: <strong>{{ student_score.score }}/{{ assignment.max_score }}</strong>
                        </div>
                    {% else %}
                        <div class="score not-submitted">
                            Работа не сдана
                        </div>
                    {% endif %}
                    
                    <a href="{{ url_for('main.submit_assignment', assignment_id=assignment.id) }}" 
                       class="btn btn-small">
                        {{ 'Изменить решение' if student_score else 'Сдать работу' }}
                    </a>
                </div>
            </div>
            {% else %}
            <div class="no-assignments">
                <p>На данный момент у вас нет активных заданий</p>
            </div>
            {% endfor %}
        </div>
    </div>
</div>
{% endblock %}
