{% extends "base.html" %}

{% block title %}Панель студента{% endblock %}

{% block content %}
<div class="dashboard-container">
    <h1 class="welcome-title">Добро пожаловать, {{ current_user.name }}!</h1>

    {% with messages = get_flashed_messages() %}
        {% if messages %}
            <div class="flashes">
                {% for message in messages %}
                    <div class="flash">{{ message }}</div>
                {% endfor %}
            </div>
        {% endif %}
    {% endwith %}

    <!-- Блок прогресса -->
    <div class="student-progress-block">
        <span>Всего заданий: <b>{{ assignments|length }}</b></span>
        <span>Сдано: <b>{{ scores|length }}</b></span>
        <span>
            Средний балл: <b>
            {% if scores %}
                {{ (scores | map(attribute='score') | sum) // (scores|length) }}
            {% else %}
                —
            {% endif %}
            </b>
        </span>
    </div>

    <div class="assignments-section">
        <h2 class="section-title">Мои задания</h2>
        <div class="assignments-grid">
            {% for assignment in assignments %}
            <div class="assignment-card">
                <div class="assignment-header">
                    <h3>{{ assignment.title }}</h3>
                    <span class="due-date">
                        {% if assignment.deadline %}
                        Срок сдачи: {{ assignment.deadline.strftime('%d.%m.%Y') }}
                        {% else %}
                        Без срока
                        {% endif %}
                    </span>
                </div>
                <p class="assignment-description">{{ assignment.description }}</p>
                <div class="assignment-status">
                    {% set student_score = scores|selectattr('assignment_id', 'equalto', assignment.id)|first %}
                    {% if student_score %}
                        <div class="score submitted">
                            <span style="color:#339933;">Сдано</span> |
                            Ваша оценка: <strong>{{ student_score.score }}/{{ assignment.max_score }}</strong>
                        </div>
                        <a href="{{ url_for('main.submit_assignment', assignment_id=assignment.id) }}"
                            class="btn btn-small">Изменить решение</a>
                    {% else %}
                        <div class="score not-submitted">
                            <span style="color:#c23c2a;">Не сдано</span>
                        </div>
                        <a href="{{ url_for('main.submit_assignment', assignment_id=assignment.id) }}"
                            class="btn btn-small btn-primary">Сдать работу</a>
                    {% endif %}
                </div>
            </div>
            {% else %}
            <div class="no-assignments">
                <p>На данный момент у вас нет активных заданий</p>
            </div>
            {% endfor %}
        </div>
    </div>
</div>
{% endblock %}
