{% extends "base.html" %}
{% block title %}–ú–æ–∏ –∑–∞–¥–∞–Ω–∏—è{% endblock %}

{% block content %}
<div class="form-container">
    <h1>–ú–æ–∏ –∑–∞–¥–∞–Ω–∏—è</h1>
    {% if not assignments %}
        <div class="info-block">–ü–æ–∫–∞ –Ω–µ—Ç –¥–æ—Å—Ç—É–ø–Ω—ã—Ö –∑–∞–¥–∞–Ω–∏–π.<br>–ï—Å–ª–∏ –≤—ã —Å—á–∏—Ç–∞–µ—Ç–µ, —á—Ç–æ —ç—Ç–æ –æ—à–∏–±–∫–∞, –æ–±—Ä–∞—Ç–∏—Ç–µ—Å—å –∫ —Å–≤–æ–µ–º—É –ø—Ä–µ–ø–æ–¥–∞–≤–∞—Ç–µ–ª—é.</div>
    {% else %}
        <div class="assignments-grid">
            {% for assignment in assignments %}
            {% set my_submission = assignment.submissions | selectattr('student_id', 'equalto', current_user.id) | first %}
            <div class="assignment-card">
                <div class="card-header">
                    <h3>{{ assignment.title }}</h3>
                    <span class="score-label">–º–∞–∫—Å: {{ assignment.max_score }} –±–∞–ª–ª–æ–≤</span>
                </div>
                <p class="assignment-description">{{ assignment.description }}</p>
                <div class="assignment-meta">
                    <span class="deadline">üìÖ {{ assignment.deadline.strftime('%d.%m.%Y %H:%M') if assignment.deadline else '–ë–µ–∑ —Å—Ä–æ–∫–∞' }}</span>
                    <span class="created-at">üïí {{ assignment.created_at.strftime('%d.%m.%Y') }}</span>
                </div>

                <div class="assignment-actions">
                    {% if my_submission %}
                        <span class="status-done">‚úÖ –°–¥–∞–Ω–æ</span>
                        <span>–û—Ü–µ–Ω–∫–∞: {{ my_submission.score if my_submission.score is not none else "–æ–∂–∏–¥–∞–µ—Ç –ø—Ä–æ–≤–µ—Ä–∫–∏" }}</span>
                        <a href="#" onclick="showSubmissionDetails({{ my_submission.id }}); return false;" class="btn btn-small">–ü–æ–¥—Ä–æ–±–Ω–µ–µ</a>
                    {% elif assignment.deadline and assignment.deadline < now %}
                        <span class="status-late">‚è∞ –ü—Ä–æ—Å—Ä–æ—á–µ–Ω–æ</span>
                        <a href="{{ url_for('main.submit_assignment', assignment_id=assignment.id) }}" class="btn btn-small btn-primary">–°–¥–∞—Ç—å –≤—Å—ë —Ä–∞–≤–Ω–æ</a>
                    {% else %}
                        <a href="{{ url_for('main.submit_assignment', assignment_id=assignment.id) }}" class="btn btn-small btn-primary">–°–¥–∞—Ç—å –∑–∞–¥–∞–Ω–∏–µ</a>
                    {% endif %}
                </div>
            </div>
            {% endfor %}
        </div>
    {% endif %}
</div>

<!-- –ú–æ–¥–∞–ª—å–Ω–æ–µ –æ–∫–Ω–æ –¥–ª—è –ø–æ–¥—Ä–æ–±–Ω–æ—Å—Ç–µ–π –æ —Å–¥–∞—á–µ (–∑–∞–≥–ª—É—à–∫–∞) -->
<div id="submissionModal" class="modal" style="display:none;">
    <div class="modal-content">
        <span class="close" onclick="closeSubmissionModal()">&times;</span>
        <div id="submissionDetails"></div>
    </div>
</div>

<script>
function now() {
    return new Date();
}

function showSubmissionDetails(submissionId) {
    // –ó–¥–µ—Å—å –º–æ–∂–Ω–æ —á–µ—Ä–µ–∑ AJAX –ø–æ–¥–≥—Ä—É–∑–∏—Ç—å –¥–µ—Ç–∞–ª–∏ —Å–¥–∞—á–∏, –Ω–æ –ø–æ–∫–∞ –ø—Ä–æ—Å—Ç–æ –≤—ã–≤–æ–¥–∏–º id
    document.getElementById('submissionDetails').innerHTML = 'ID —Ä–∞–±–æ—Ç—ã: ' + submissionId + '<br>–ó–¥–µ—Å—å –±—É–¥—É—Ç –ø–æ–¥—Ä–æ–±–Ω–æ—Å—Ç–∏.';
    document.getElementById('submissionModal').style.display = 'block';
}
function closeSubmissionModal() {
    document.getElementById('submissionModal').style.display = 'none';
}
</script>
{% endblock %}
